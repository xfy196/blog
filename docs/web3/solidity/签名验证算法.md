---
isTimeLine: true
title: ç­¾åéªŒè¯ç®—æ³•
date: '2026-01-14'
public: true
tags:
  - web3
  - solidity
categories:
  - web3
---
# solidity ç­¾åéªŒè¯ç®—æ³•

Solidity ä¸­çš„ç­¾åéªŒè¯æ ¸å¿ƒæ˜¯**æ¤­åœ†æ›²çº¿æ•°å­—ç­¾åç®—æ³•ï¼ˆECDSAï¼‰**ï¼Œå®ƒå…è®¸æ™ºèƒ½åˆçº¦éªŒè¯ä¸€æ®µæ•°æ®æ˜¯å¦ç”±ç‰¹å®šçš„ç§é’¥æŒæœ‰è€…ç­¾å‘ã€‚è¿™åœ¨ç™½åå•ã€ä»£å¸é“¸é€ ç­‰åœºæ™¯ä¸­è‡³å…³é‡è¦ã€‚å…¶æ ¸å¿ƒåŸç†å¯ä»¥æ¦‚æ‹¬ä¸ºâ€œé“¾ä¸‹ç­¾åï¼Œé“¾ä¸ŠéªŒè¯â€ã€‚

ä¸‹é¢è¿™ä¸ªè¡¨æ ¼æ€»ç»“äº†ECDSAç­¾åéªŒè¯æµç¨‹ä¸­çš„å…³é”®è§’è‰²å’Œæ­¥éª¤ã€‚

| æ­¥éª¤ | è§’è‰² | å…³é”®åŠ¨ä½œ | è¯´æ˜ |
| :--- | :--- | :--- | :--- |
| **1. ç”Ÿæˆç­¾åï¼ˆé“¾ä¸‹ï¼‰** | ç”¨æˆ·/å‰ç«¯ | **åˆ›å»ºæ¶ˆæ¯å“ˆå¸Œ**ï¼šå°†å¾…ç­¾åçš„æ•°æ®ï¼ˆå¦‚åœ°å€ã€æ•°é‡ï¼‰æ‰“åŒ…å¹¶è®¡ç®—å“ˆå¸Œã€‚ | ç¡®ä¿æ•°æ®æ ¼å¼ä¸€è‡´ã€‚ |
| | | **æ·»åŠ ä»¥å¤ªåŠå‰ç¼€**ï¼šåœ¨å“ˆå¸Œå‰æ·»åŠ ç‰¹å®šå­—ç¬¦`\x19Ethereum Signed Message:\n32`å¹¶å†æ¬¡å“ˆå¸Œã€‚ | é˜²æ­¢ç­¾åè¢«æ¶æ„ç”¨äºäº¤æ˜“ã€‚ |
| | | **ä½¿ç”¨ç§é’¥ç­¾å**ï¼šå¯¹å¤„ç†åçš„å“ˆå¸Œè¿›è¡Œç­¾åï¼Œå¾—åˆ° `r`, `s`, `v` ä¸‰ä¸ªç»„ä»¶ã€‚ | ç­¾åç»“æœé•¿åº¦é€šå¸¸ä¸º65å­—èŠ‚ã€‚ |
| **2. éªŒè¯ç­¾åï¼ˆé“¾ä¸Šï¼‰** | æ™ºèƒ½åˆçº¦ | **é‡ç»„æ¶ˆæ¯å“ˆå¸Œ**ï¼šåœ¨åˆçº¦å†…ï¼Œç”¨ç›¸åŒè§„åˆ™å¯¹ä¼ å…¥çš„æ•°æ®è¿›è¡Œæ‰“åŒ…å’Œå“ˆå¸Œè®¡ç®—ã€‚ | å¿…é¡»ä¸é“¾ä¸‹æ­¥éª¤å®Œå…¨ä¸€è‡´ã€‚ |
| | | **è°ƒç”¨ `ecrecover`** | è¿™æ˜¯æœ€æ ¸å¿ƒçš„ç¯èŠ‚ã€‚`ecrecover` æ˜¯ä¸€ä¸ªå†…ç½®å‡½æ•°ï¼Œå®ƒæ¥æ”¶**æ¶ˆæ¯å“ˆå¸Œ**ã€ç­¾åç»„ä»¶ `r`, `s`, `v`ï¼Œå¹¶è®¡ç®—å‡ºä¸€ä¸ªä»¥å¤ªåŠåœ°å€ã€‚ |
| | | **æ¯”å¯¹åœ°å€**ï¼šå°† `ecrecover` è¿”å›çš„åœ°å€ä¸é¢„è®¾çš„åˆæ³•ç­¾åè€…åœ°å€è¿›è¡Œæ¯”å¯¹ã€‚ | å¦‚æœä¸€è‡´ï¼Œåˆ™ç­¾åæœ‰æ•ˆã€‚ |

### ğŸ”‘ æ ¸å¿ƒç»„ä»¶ä¸å®‰å…¨å®è·µ

#### ç­¾åæ„æˆ (r, s, v)
ä¸€ä¸ªå®Œæ•´çš„ECDSAç­¾åç”±ä¸‰éƒ¨åˆ†ç»„æˆï¼š
- **r (32å­—èŠ‚)**ï¼šç­¾åçš„ä¸€éƒ¨åˆ†ï¼Œä»£è¡¨æ¤­åœ†æ›²çº¿ç‚¹çš„ä¸€ä¸ªåæ ‡å€¼ã€‚
- **s (32å­—èŠ‚)**ï¼šç­¾åçš„å¦ä¸€éƒ¨åˆ†ã€‚
- **v (1å­—èŠ‚ï¼Œæ¢å¤æ ‡è¯†ç¬¦)**ï¼šç”¨äºåœ¨éªŒè¯æ—¶ç¡®å®šä½¿ç”¨å“ªä¸ªå…·ä½“çš„æ¤­åœ†æ›²çº¿ç‚¹ï¼Œå…¶å€¼é€šå¸¸æ˜¯27æˆ–28ã€‚ åœ¨åˆçº¦ä¸­è§£æç­¾åæ—¶ï¼Œéœ€è¦æ­£ç¡®åœ°ä»65å­—èŠ‚çš„ç­¾åæ•°æ®ä¸­æå–å‡ºè¿™ä¸‰éƒ¨åˆ†ã€‚

#### è°¨é˜²ç­¾åé‡æ”¾æ”»å‡»
è¿™æ˜¯ç­¾åéªŒè¯ä¸­æœ€ä¸»è¦çš„å®‰å…¨é£é™©ã€‚æ”»å‡»è€…å¯ä»¥æ‹¦æˆªå¹¶é‡å¤ä½¿ç”¨ä¸€ä¸ªæœ‰æ•ˆçš„ç­¾åã€‚é˜²å¾¡ç­–ç•¥åŒ…æ‹¬ï¼š
- **è®°å½•å·²ä½¿ç”¨çš„ç­¾å**ï¼šä½¿ç”¨æ˜ å°„ï¼ˆmappingï¼‰è®°å½•æ¯ä¸ªç­¾åæ˜¯å¦å·²è¢«ä½¿ç”¨ï¼Œé˜²æ­¢åŒä¸€ç­¾åè¢«å¤šæ¬¡æäº¤ã€‚
- **åŠ å…¥ä¸Šä¸‹æ–‡ä¿¡æ¯**ï¼šåœ¨ç­¾åæ¶ˆæ¯ä¸­åŒ…å«**Nonceï¼ˆä¸€æ¬¡æ€§ç¼–å·ï¼‰** å’Œ **ChainIDï¼ˆåŒºå—é“¾IDï¼‰**ï¼Œç¡®ä¿ç­¾åä»…èƒ½åœ¨ç‰¹å®šäº¤æ˜“å’Œç‰¹å®šé“¾ä¸Šä½¿ç”¨ä¸€æ¬¡ï¼Œæœ‰æ•ˆé˜²èŒƒè·¨é“¾é‡æ”¾æ”»å‡»ã€‚

### ğŸ’¡ ä¸€ä¸ªç®€å•çš„åº”ç”¨åœºæ™¯ï¼šNFTç™½åå•

å‡è®¾ä¸€ä¸ªNFTé¡¹ç›®è¦ä¸ºç”¨æˆ·æä¾›ç™½åå•é“¸é€ æƒé™ï¼š
1.  **é¡¹ç›®æ–¹ç­¾å**ï¼šé¡¹ç›®æ–¹ç”¨è‡ªå·±æŒæœ‰çš„ç§é’¥ï¼Œä¸ºæ¯ä¸ªç™½åå•ç”¨æˆ·çš„åœ°å€å’Œå¯é“¸é€ çš„TokenIDç”Ÿæˆä¸€ä¸ªç­¾åã€‚
3.  **ç”¨æˆ·æäº¤**ï¼šç”¨æˆ·è°ƒç”¨åˆçº¦çš„`mint`å‡½æ•°ï¼Œæäº¤è‡ªå·±çš„åœ°å€ã€TokenIDå’Œæ”¶åˆ°çš„ç­¾åã€‚
4.  **åˆçº¦éªŒè¯**ï¼šåˆçº¦ä½¿ç”¨ä¸Šè¿°æµç¨‹éªŒè¯ç­¾åã€‚å¦‚æœé€šè¿‡ï¼Œåˆ™ä¸ºç”¨æˆ·é“¸é€ NFTï¼Œå¹¶å°†è¯¥ç­¾åæ ‡è®°ä¸ºå·²ä½¿ç”¨ï¼›å¦åˆ™äº¤æ˜“å¤±è´¥ã€‚

**ç®€å•æ¥çœ‹ä¸ªdemo**
```solidity
// SPDX-License-Identifier: MIT
pragma solidity ^0.8.26;

contract VerifySig{
    function getMessageHash(string memory _message) public pure returns (bytes32){
        return keccak256(abi.encodePacked(_message));
    }
    function getEthSignedMessageHash(bytes32 _messageHash) public pure returns (bytes32){
        return keccak256(abi.encodePacked("\x19Ethereum Signed Message:\n32",_messageHash));
    }
    function recover(bytes32 _ethSignedMessageHash, bytes memory _sig) public pure returns (address){
        (bytes32 r , bytes32 s, uint8 v) = _split(_sig);
        return ecrecover(_ethSignedMessageHash, v, r, s);
    }
    function _split(bytes memory _sig) internal pure returns (bytes32 r, bytes32 s, uint8 v){
        require(_sig.length == 65, "invalid signature length");
        assembly {
            r := mload(add(_sig, 32))
            s := mload(add(_sig, 64))
            v := byte(0, mload(add(_sig, 96)))
        }
    }
    function verify(address _signer, string memory _message, bytes memory _sig) external pure returns(bool){
        bytes32 messageHash = getMessageHash(_message);
        bytes32 ethSignedMessageHash = getEthSignedMessageHash(messageHash);
        return recover(ethSignedMessageHash, _sig) == _signer;
    }
    
}
```