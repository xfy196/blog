---
isTimeLine: true
title: å‰ç«¯ç¦éŸ³-Serverlessæ— æœåŠ¡å“åº”ï¼Œæ— è„‘æ­å»ºå±äºè‡ªå·±çš„å‰åç«¯æœåŠ¡
date: 2021-04-19
tags:
  - JavaScript
categories:
  - å‰ç«¯
  - éƒ¨ç½²æœåŠ¡
---

# å‰ç«¯ç¦éŸ³-Serverless æ— æœåŠ¡å“åº”ï¼Œæ— è„‘æ­å»ºå±äºè‡ªå·±çš„å‰åç«¯æœåŠ¡

è¿˜åœ¨ä¸ºå‰ç«¯ä¸æ˜¯ä»£ç å‘æ„ä¹ˆï¼Œè¿˜åœ¨ä¸ºå‰ç«¯æ²¡æœ‰åç«¯å‘æ„ä¹ˆï¼Ÿæœ‰äº†å®ƒ(Serverless)ï¼Œ æˆ‘è§‰å¾—ä½ ä»æ­¤èµ°å‘äººç”Ÿå·…å³°ã€‚ç»å¸¸æœ‰åŒå­¦é—®æˆ‘ï¼Œè‡ªå·±å†™äº†ä¸ªé¡¹ç›®ï¼Œæ€ä¹ˆéƒ¨ç½²å•Šï¼Œlinux ä¸å¤ªç†Ÿï¼Œè€Œä¸”è¿˜éœ€è¦èŠ±é’±ä¹°æœåŠ¡å™¨ï¼Œè¿™æ€ä¹ˆåŠäº†ã€‚ä»–æ¥äº†!ä»–æ¥äº†ï¼ä»–æ¥äº†ï¼[ vercel](https://vercel.com/) ä¸€ä¸ªç”± next.js å›¢é˜Ÿæ‰“é€ çš„ Serverless å¹³å°ã€‚

### Vercel æ˜¯ä»€ä¹ˆï¼Ÿ

ç®€å•æ¥è¯´ä»–å’Œ gitpage å¾ˆåƒï¼Œä½ å¯ä»¥é€šè¿‡ç±»ä¼¼ hexo è¿™æ ·é™æ€æ¨¡æ¿æŠ€æœ¯æ¥éƒ¨ç½²ä¸€å¥—å±äºè‡ªå·±çš„ä¸ªäººåšå®¢ï¼Œ è¿™ä¸ªå®é™…ä¸Š github å·²ç»è‡ªå¸¦äº†ï¼Œå¯ä»¥å‚è€ƒä½œè€…çš„ github åšå®¢ [ä¸ªäººåšå®¢ ](https://xfy196.github.io/)ï¼Œä½†æ˜¯ vercel å¯æ²¡é‚£ä¹ˆç®€å•ï¼Œä»–å¯èƒ½æ˜¯ä¸ªçˆ¸çˆ¸ã€‚é‚£ä¹ˆ vercel åˆ°åº•å¯ä»¥å¹²ä»€ä¹ˆï¼Ÿé™¤äº†ç±»ä¼¼äº gitpage éƒ¨ç½²ä¸€å¥—é™æ€æ¨¡æ¿ï¼Œè¿˜æ”¯æŒçš„å¯æ¯” gitpage å¤šå¤šäº†ï¼Œæˆ‘ä»¬ç…ç…ï¼š

![FireShot Capture 003 - New Project â€“ Vercel - vercel.com.png](https://cdn.jsdelivr.net/gh/xfy196/images@main/202308141402902.png)

ä¸Šé¢å°±æ˜¯ vercel æ‰€æ”¯æŒçš„ï¼Œè€Œ gitpage æ‰€æä¾›çš„æœåŠ¡ï¼Œä»…ä»…æ˜¯ç¼–å†™é™æ€é¡µé¢ï¼Œç„¶åæŒ‰ç…§ä¸€å®šçš„è§„åˆ™è¿›è¡Œå½’ç±»ï¼Œè™½ç„¶å¸‚é¢ä¸Šæœ‰æ¯”è¾ƒå¥½ç”¨çš„å·¥å…·å¯ä»¥ç”Ÿæˆè¿™äº›é™æ€é¡µé¢,ä¾‹å¦‚(hexo, gitbook)ä½†æ˜¯èƒ½åŠŸèƒ½ä¾æ—§æ²¡æœ‰æ²¡æœ‰ vercel å¼ºå¤§ï¼Œçµæ´»åº¦ä¹Ÿä¸å¤Ÿã€‚vercel ä¸ä»…è§£æ hexoï¼Œgitbook çš„åŠŸèƒ½åŒæ—¶è¿˜æ”¯æŒ pc ç«¯ç§»åŠ¨ç«¯ï¼Œå¹¶ä¸”åŸºäºå‰ç«¯ä¸»æµæ¡†æ¶ä½œä¸ºæ¨¡æ¿ï¼Œä¾‹å¦‚ï¼šVue.js, React.js, Svelte.js, Angular, Nuxt.js, Next.js éƒ½æ”¯æŒï¼Œä¹Ÿå°±æ˜¯è¯´åŸºæœ¬åŒ…å«äº†æ‰€æœ‰å¸‚é¢ä¸»æµçš„æ¡†æ¶æŠ€æœ¯ï¼Œå°½ç®¡æˆ‘ä»¬ä¸ä¾èµ– Vueï¼ŒReact è¿™æ ·çš„æ¡†æ¶å¼€å‘ï¼Œä¸æˆ‘æ— å…³ç´§è¦ï¼Œä½ å¯ä»¥è‡ªå·±è¾¹å†™ï¼Œéƒ¨ç½²è„šæœ¬ï¼ŒåŸºäºè‡ªå·±çš„è§„åˆ™ï¼Œè®© nodejs å¸®ä½ å¤„ç†å’Œæ‰“åŒ…ï¼Œè€Œä¸”å®ƒè¿˜å…·å¤‡ä¸ github æˆ–è€… Gitlab å®æ—¶å“åº”çš„åŠŸèƒ½ï¼Œåªè¦æ˜ å°„è¿‡ä»“åº“åœ°å€ï¼Œé‚£ä¹ˆä»“åº“çš„æ•°æ®å‘ç”Ÿå˜åŒ–ï¼Œvercel å°±ä¼šé‡æ–°æ›´æ–°éƒ¨ç½²ï¼Œæ— éœ€æ‰‹åŠ¨éƒ¨ç½²ï¼Œè¿™ä¹Ÿå°±æ˜¯ CI éƒ¨ç½²ã€‚é‚£ä¹ˆé—®é¢˜æ¥äº†ï¼Œå‰ç«¯é¡µé¢ vercel å¸®æˆ‘ä»¬å¤„ç†å¥½äº†ï¼Œåç«¯æ•°æ®æ€ä¹ˆåŠå‘¢ã€‚ğŸ‚ å°± ğŸ‚ åœ¨è¿™é‡Œäº†ï¼Œvercel æ˜¯ Serverless æ¶æ„çš„ï¼Œå¯ä»¥å¸®æˆ‘ä»¬å®Œæˆ Fass åº”ç”¨çš„éƒ¨ç½²ï¼Œç°å·²æ”¯æŒ Node.js, Go, Python, Ruby è¯­è¨€äº†ï¼Œé‚£ä¹ˆå¯¹æˆ‘ä»¬å‰ç«¯çš„å°ä¼™ä¼´å¤ªå‹å¥½äº†ï¼Œçœ‹åˆ° Node.jsï¼Œå¾ˆå¤šå‰ç«¯åŒå­¦æ˜¯ä¸æ˜¯å¾ˆæ¿€åŠ¨ï¼Œåæ­£æˆ‘æ˜¯å¾ˆæ¿€åŠ¨,ğŸ˜œï¼Œä»–å¯ä»¥è®© nodejs æœåŠ¡éƒ¨ç½²åœ¨ä¸Šé¢ï¼Œæ¥ä¸ºå„ä¸ªæœåŠ¡æä¾›æ”¯æŒï¼Œä¾‹å¦‚:egg.js, express, koa ç­‰è¿™äº› web æœåŠ¡æ¡†æ¶ï¼Œå¦å¯ä»¥éƒ¨ç½²åœ¨ä¸Šé¢ã€‚

> è¯´äº†è¿™ä¸ªå¤šæˆ‘ä»¬è¿˜æ˜¯æ¥è¯•è¯•å§

### ç©ä¸€ç© vercel

é¦–å…ˆæˆ‘ä»¬è¿›å…¥ç½‘ç«™[ ](https://vercel.com/)

![image.png](https://cdn.jsdelivr.net/gh/xfy196/images@main/202308141404716.png)

è¿™é‡Œæˆ‘ä»¬å…ˆéƒ¨ç½² express çš„é¡¹ç›®
![image.png](https://cdn.jsdelivr.net/gh/xfy196/images@main/202308141404800.png)
ç‚¹å‡» import å¯¼å…¥é¡¹ç›®

![image.png](https://cdn.jsdelivr.net/gh/xfy196/images@main/202308141404996.png)

![image.png](https://cdn.jsdelivr.net/gh/xfy196/images@main/202308141404791.png)

![image.png](https://cdn.jsdelivr.net/gh/xfy196/images@main/202308141405693.png)

![image.png](https://cdn.jsdelivr.net/gh/xfy196/images@main/202308141405248.png)

![image.png](https://cdn.jsdelivr.net/gh/xfy196/images@main/202308141405478.png)
æˆ‘ä»¬æµè§ˆä¸€ä¸‹ï¼Œç‚¹å‡» visit

![image.png](https://cdn.jsdelivr.net/gh/xfy196/images@main/202308141405323.png)
æˆåŠŸè¿›å…¥ express é»˜è®¤çš„é¡µé¢
è¿™æ ·ä¸€æ¥ nodejs çš„æ¥å£æœåŠ¡ä¹Ÿéƒ¨ç½²å¥½äº†ï¼Œä½†æ˜¯æƒ³è¦æˆåŠŸéƒ¨ç½² nodejs çš„é¡¹ç›®æˆ‘ä»¬è¿˜éœ€è¦åœ¨æˆ‘ä»¬çš„é¡¹ç›®é…ç½®ä¸€äº›ä¸œè¥¿,æˆ–è€…è‡ªå·±é‡æ–°è®¾ç½®ä¸€ä¸‹å¯åŠ¨è„šæœ¬

- ç¬¬ä¸€æ­¥
  åœ¨æˆ‘ä»¬çš„é¡¹ç›®æ ¹ç›®å½•åˆ›å»º vercel.json
  ![image.png](https://cdn.jsdelivr.net/gh/xfy196/images@main/202308141406784.png)

```json
{
  "version": 2,
  "builds": [
    {
      "src": "./index.js",
      "use": "@vercel/node"
    }
  ],
  "routes": [
    {
      "src": "/(.*)",
      "dest": "/"
    }
  ]
}
```

çœ‹èµ·æ¥çš„æ„æ€æ˜¯è¯´ src çš„æ ¹æ–‡ä»¶æ˜¯ index.js ä½¿ç”¨ vercel çš„ node è¿è¡Œè¿™ä¸ªæ–‡ä»¶ï¼Œé‚£æˆ‘ä»¬å†çœ‹çœ‹ index.js ä¸‹é¢æœ‰ä»€ä¹ˆå§

![image.png](https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/c56c9028182846aca4d59d28c42efed4~tplv-k3u1fbpfcp-watermark.image)
çœ‹èµ·æ¥æ²¡å•¥ï¼Œç›´æ¥ä¸€è¡Œä»£ç  ğŸ™ƒï¼Œä½†æ˜¯å¦‚æœä½ æ˜¯ä¸€ä¸ªç†Ÿæ‚‰ express å¼€å‘å’Œ common.js è§„èŒƒçš„äººä½ å°±æ˜ç™½è¿™å¥è¯æ˜¯ä»€ä¹ˆæ„æ€äº†ã€‚æ„æ€å°±æ˜¯: è°ƒç”¨ index.jsï¼Œå°±ä¼šæ‰§è¡Œ require() ï¼Œè€Œ require åº•å±‚å®é™…ä¸Šæ˜¯ä¸€ä¸ªè‡ªæ‰§è¡Œå‡½æ•°ï¼Œé‚£ä¹ˆé—´æ¥çš„è°ƒç”¨äº†./bin/www æ–‡ä»¶ï¼Œè€Œä¸” express-generator ä¸­å¯åŠ¨æ–‡ä»¶å°±æ˜¯ bin/www æ–‡ä»¶,è¿™æ ·ä¸€æ¥ express çš„æœåŠ¡å°±å¯åŠ¨äº†ï¼Œé‚£ä¹ˆ vercel é‚£ä¸ªæ–‡ä»¶é…ç½®çš„ç›®çš„ï¼Œå°±æ˜¯å‘Šè¯‰é»˜è®¤çš„ vercel ä¸è¦å» build äº†ç›´æ¥æŒ‰ç…§æˆ‘å‘Šè¯‰ä½ çš„æ‰§è¡ŒåŒºæ‰§è¡Œè„šæœ¬å§ã€‚ok åˆ°æ­¤å®é™…ä¸Š node çš„æœåŠ¡å·²ç»æ­å»ºæˆåŠŸäº†ã€‚

**åˆ°è¿™æ¥è¯´ Serverless å¹¶æ²¡æœ‰å®Œå…¨ä½“ç°ï¼ŒFass ä¹Ÿæ²¡æœ‰å®Œå…¨ä½“ç°ï¼Œå†çœ‹æ¥ä¸‹æ¥çš„æ¡ˆä¾‹ï¼Œä½ ä¹Ÿè®¸å°±ä¼šæ˜ç™½äº†**
æˆ‘ä»¬æŒ‰ç…§åˆšæ‰çš„éƒ¨ç½²é‡æ–°å¯¼å…¥ä¸€ä¸ªæ–°çš„é¡¹ç›®ï¼Œè¿™ä¸ªæ–°çš„é¡¹ç›®å‘¢æˆ‘ä»¬ä¸ä½¿ç”¨ä»»ä½•çš„è„šæ‰‹æ¶æˆ–è€…æ¡†æ¶ï¼Œèµ·å api-proxy
å¤§è‡´çš„ç›®å½•æ˜¯è¿™æ ·çš„

![image.png](https://p6-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/48fea51aaefe426685be63bf58c71de4~tplv-k3u1fbpfcp-watermark.image)
å°±æ˜¯ä¸€ä¸ª npm init åˆ›å»ºçš„é¡¹ç›®ï¼Œä¸è¿‡æœ‰ä¸€ç‚¹ä¸ä¸€æ ·çš„å°±æ˜¯æˆ‘åˆ›å»ºäº†ä¸€ä¸ª api æ–‡ä»¶å¤¹ï¼Œè¿™é‡Œé¢è¦å†™çš„ js å°±æ˜¯ä¸€ä¸ªä¸ªçš„ Functionï¼Œæ¯ä¸€ä¸ª Function å°±æ˜¯æä¾›è¿™ä¸€ç±»æœåŠ¡ï¼Œè¿™é‡Œæˆ‘ä»¬ç¼–å†™ä¸€ä¸ªæ¯”è¾ƒç®€å•çš„ä»£ç†æœåŠ¡çš„ Functionï¼Œæ¥æ¼”ç¤º Fass çš„åº”ç”¨ã€‚

```js
const { createProxyMiddleware } = require('http-proxy-middleware')

module.exports = (req, res) => {
  let target = ''

  // ä»£ç†ç›®æ ‡åœ°å€
  // è¿™é‡Œä½¿ç”¨ backend ä¸»è¦ç”¨äºåŒºåˆ† vercel serverless çš„ api è·¯å¾„
  if (req.url.startsWith('/api')) {
    target = 'https://api.music.xxytime.top'
  }

  // åˆ›å»ºä»£ç†å¯¹è±¡å¹¶è½¬å‘è¯·æ±‚
  createProxyMiddleware({
    target,
    changeOrigin: true,
    pathRewrite: {
      '^/api/': '/'
    }
  })(req, res)
}
```

å¦‚æœä½ ç†Ÿæ‚‰ nodejsï¼Œåº”è¯¥èƒ½æ˜ç™½è¿™é‡Œå€ŸåŠ©äº†`http-proxy-middleware`å®Œæˆäº†ä¸€ä¸ªæ¥å£ä»£ç†æœåŠ¡ã€‚
æ¥ä¸‹æ¥è¿˜æ˜¯è€æ ·å­ï¼Œå›åˆ° vercel å®˜ç½‘ï¼ŒæŠŠä¹‹å‰é¡¹ç›®ä» git ä¸­æ¥å»è¿›æ¥éƒ¨ç½²ï¼Œéƒ¨ç½²æˆåŠŸä¹‹åå‘¢ï¼Œä½ åœ¨æµè§ˆå™¨ä¸­è¾“å…¥å½“å‰ä»£ç†çš„æ¥å£ï¼Œä½ ä¼šå‘ç°æ¥å£ä»£ç†æˆåŠŸäº†ã€‚

![image.png](https://p6-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/9924cfb8d4a24e68a8ac0853fb43fe9b~tplv-k3u1fbpfcp-watermark.image)
å¦‚æœè¿˜ä¸ç›¸ä¿¡çš„è¯ï¼Œä½ å¯ä»¥è¿”å›è¿™ä¸ªé¡¹ç›®çš„ dashborad ä¸­æŸ¥çœ‹ä¸€ä¸ªå« Functions çš„é¢æ¿

![image.png](https://p6-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/b46aee497f35446385a826a2f53e88c8~tplv-k3u1fbpfcp-watermark.image)
ä½ æ‰€æœ‰çš„è¯·æ±‚å“åº”çŠ¶æ€éƒ½ä¼šåœ¨é‡Œæ˜¾ç¤ºã€‚

**éƒ¨ç½²å‰ç«¯çš„ä»£ç é‚£å°±æ¯”è¾ƒå®¹æ˜“äº†**
æˆ‘ä»¬åªéœ€è¦é€‰æ‹©å¥½ç¼–å†™å‰ç«¯ä»£ç çš„æ¨¡æ¿æˆ–è€…è‡ªå®šä¹‰è„šæœ¬ï¼Œç„¶åæ‰§è¡Œä¸ä¸Šä¸€æ ·çš„æ“ä½œå³å¯ï¼Œæœ€åéƒ¨ç½²å‡ºæ¥çš„æ•ˆæœå°±æ˜¯ï¼šæ‹¿ç€ä½œè€…éƒ¨ç½²çš„å‰åç«¯é¡¹ç›®æ¼”ç¤º

[react ç‰ˆæœ¬ç½‘æ˜“äº‘éŸ³ä¹](https://music.xxytime.top/)

[Vue3.0 ç‰ˆæœ¬ç½‘æ˜“äº‘](https://mp.v3music.xxytime.top/)

[ç½‘æ˜“äº‘æ¥å£æœåŠ¡](https://musicapi.xxytime.top/api/banner)

åŒæ—¶æ¬¢è¿å„ä½åŒå­¦æ¥æˆ‘çš„ github ä¸­ç‚¹èµï¼Œå­¦ä¹ ï¼Œäº¤æµ

[react ç‰ˆæœ¬ç½‘æ˜“äº‘](https://github.com/xfy196/cloud-music-react)

[Vue3.0 ç‰ˆæœ¬ç½‘æ˜“äº‘](https://github.com/xfy196/vue3.0-cloud-music)
